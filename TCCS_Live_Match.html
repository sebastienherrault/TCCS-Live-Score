<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Saisie Scores - TCCS</title>
 <meta name="color-scheme" content="light dark" />
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<style>
    :root {
      --bg: #0b1320; --fg: #e8eefc; --muted: #aeb8d0; --accent: #2f80ed;
      --ok: #2ecc71; --warn: #f39c12; --err: #e74c3c; --card: #141b2d; --border: #25314e;
      --menu-bg: #0b1220; --menu-fg: #e5e7eb; --menu-accent: #60a5fa; --menu-border: #1f2937; --shadow: 0 8px 24px rgba(0,0,0,.25);
    }
    html, body { margin:0; padding:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: var(--bg); color: var(--fg); }
    a { color: var(--fg); text-decoration: none; } a:hover { text-decoration: underline; }
    header { display:flex; align-items:center; justify-content:space-between; gap:16px; padding:16px 80px; border-bottom: 1px solid var(--border); background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0)); }
    .brand { display:flex; align-items:center; gap:12px; }
    .brand-logo { inline-size:40px; block-size:40px; background:#1d2a44; border-radius:8px; display:grid; place-items:center; font-weight:700; }
    .brand-title { font-size: 40px; font-weight:100; letter-spacing:.2px; }
    .userbox { display:flex; align-items:center; gap:12px; }
    .user-email { color: var(--muted); font-size:.95rem; }
	.btn { background: #aeb8d0; color:white; border:2px solid var(--border); padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:600; }
     main { max-inline-size: 900px; margin: 32px auto; padding-inline: 20px; }
    .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:16px; }
    .card { background: var(--card); border:1px solid var(--border); padding:18px; border-radius:14px; display:flex; flex-direction:column; gap:10px; cursor: pointer; }
    .card h3 { margin:0; font-size:1.05rem; color: #F2F5FF}
    .card p { margin:0; color: var(--muted); font-size:.95rem; }
	footer { text-align:center; color:var(--muted); padding:30px 16px; border-top:1px solid var(--border); margin-top: 40px; }

	#no-match-message { font-size: 3em; font-style: oblique; font-weight: bold; color: #aeb8d0; text-align: center; margin-top: 40px; animation: blink 1s infinite; }
	@keyframes blink { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }

	.hamburger-wrapper { position: fixed; top: 12px; left: 12px; z-index: 1100; }

	/* Bouton hamburger rond et discret */
	.hamburger-btn { width: 40px; height: 40px; border-radius: 999px; border: 1px solid var(--menu-border); background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(4px); display: grid; place-items: center; cursor: pointer; color: var(--menu-fg); }
	.hamburger-btn:focus-visible { outline: 2px solid var(--menu-accent); outline-offset: 2px; }

	/* Ic√¥ne 3 traits */
	.hamburger-icon { display: inline-block; width: 18px; }
	.hamburger-icon span { display: block; height: 2px; background: var(--menu-fg); margin: 3px 0; width: 100%; border-radius: 2px; transition: transform .2s ease, opacity .2s ease; }

	/* Animation en X quand menu ouvert */
	.hamburger-btn[aria-expanded="true"] .hamburger-icon span:nth-child(1) { transform: translateY(5px) rotate(45deg); }
	.hamburger-btn[aria-expanded="true"] .hamburger-icon span:nth-child(2) { opacity: 0; }
	.hamburger-btn[aria-expanded="true"] .hamburger-icon span:nth-child(3) { transform: translateY(-5px) rotate(-45deg); }

	/* Menu d√©roulant */
	.dropdown { position: absolute; top: 48px; left: 0; min-width: 220px; background: var(--menu-bg); color: var(--menu-fg); border: 1px solid var(--menu-border); border-radius: 10px; padding: 8px; box-shadow: var(--shadow);  opacity: 0; transform: translateY(-6px); pointer-events: none; transition: opacity .15s ease, transform .15s ease; }
	.dropdown.open { opacity: 1; transform: translateY(0); pointer-events: auto; }
	.dropdown a { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: 8px; color: inherit; text-decoration: none; white-space: nowrap; }
	.dropdown a:hover, .dropdown a:focus { background: #111827; outline: none; }
	.dropdown a.active { border: 1px solid #12325f; background: #0b254a; color: var(--menu-accent); }
</style>
</head>
<body>
	<!-- Garde visuelle tant qu‚Äôon n‚Äôa pas valid√© l‚Äôauth -->
	<div id="guard">Chargement‚Ä¶</div>

	<!-- Bouton hamburger + menu d√©roulant -->
	<div class="hamburger-wrapper">
	  <button id="hamburgerBtn"
			  class="hamburger-btn"
			  aria-haspopup="true"
			  aria-expanded="false"
			  aria-controls="dropdownMenu"
			  aria-label="Ouvrir le menu">
		<!-- Ic√¥ne 3 traits -->
		<span aria-hidden="true" class="hamburger-icon">
		  <span></span><span></span><span></span>
		</span>
	  </button>

	  <nav id="dropdownMenu" class="dropdown" role="menu" aria-label="Menu principal">
		<a href="index.html" role="menuitem" data-title="Accueil">üè† Accueil</a>
		<a href="TCCS_Live_Match.html" role="menuitem" data-title="Feuille de match">üìã Feuille de matchs</a>
		<a href="TCCS_Live_Saisie.html" role="menuitem" data-title="Saisie des scores">üéæ Saisie des Scores</a>
		<a href="TCCS_Live_Score.html" role="menuitem" data-title="Affichage des scores">üì∫ Affichages des Scores</a>
	  </nav>
	</div>

	<div class="overlay" id="app">
		<header>
			<div class="brand" role="banner">
				<img src="TCCS.JPG" alt="Logo TCCS" class="img-fluid mb-4" style="max-width: 100px;">
				<div class="brand-title"><b>üèÜ TCCS Score Live - Gestion des matchs de la journ√©e</b></div>
			</div>
			<div class="userbox">
				<span id="whoami" style="opacity:.8; margin-right:8px;"></span>
				<button id="logout" class="btn">Se d√©connecter</button>
			</div>
		</header>
	</div>
<main>
    <div class="grid" aria-label="Navigation">
      <button id="openExcel" class="card">
        <h3>üìù Charger Feuille de Matchs</h3>
        <p>Importer la liste des matchs (Excel).</p>
		<input type="file" id="fileInput" accept=".xlsx,.xls,.xlsm" style="display:none" />
      </button>
      <button id="deleteBtn" class="card">
        <h3>‚å®Ô∏è Supprimer Feuille de Matchs</h3>
        <p> Effacer la liste des matchs (Tout sera perdu!).</p>
      </button>
    </div>
<div id="forms"></div>
<script type="module">
	import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
	import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
	// (Optionnel) si tu utilises Firestore pour tes matchs :
	// import { getFirestore } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

	// Your web app's Firebase configuration
	// For Firebase JS SDK v7.20.0 and later, measurementId is optional
	const firebaseConfig = {
		apiKey: "AIzaSyBk63PQRrlg6647pGw5Dof5-I-LCLexJrg",
		authDomain: "tccs-live-score.firebaseapp.com",
		databaseURL: "https://tccs-live-score-default-rtdb.europe-west1.firebasedatabase.app",
		projectId: "tccs-live-score",
		storageBucket: "tccs-live-score.firebasestorage.app",
		messagingSenderId: "142574190845",
		appId: "1:142574190845:web:654340ce971abe7cf8fe94",
		measurementId: "G-E2Q9H3JRDG"
	};


	const app = initializeApp(firebaseConfig);
	const auth = getAuth(app);

	const guard = document.getElementById('guard');
	const appRoot = document.getElementById('app');
	const whoami = document.getElementById('whoami');

	onAuthStateChanged(auth, (user) => {
	  if (!user) {
		// Non connect√© -> retour au login
		window.location.href = "index.html";
		return;
	  }
	  // Connect√© -> r√©v√®le l‚Äôapp
	  guard.style.display = 'none';
	  appRoot.style.display = 'block';
	  whoami.textContent = user.email || 'Connect√©';
	});

	document.getElementById('logout').addEventListener('click', async () => {
	  try {
		await signOut(auth);
	  } finally {
		window.location.href = "index.html";
	  }
	});
</script>
<script type="module">
	// Import the functions you need from the SDKs you need
	import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
	import { getDatabase, ref, set, get, remove } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";
 
	// TODO: Add SDKs for Firebase products that you want to use
	// https://firebase.google.com/docs/web/setup#available-libraries

	// Your web app's Firebase configuration
	// For Firebase JS SDK v7.20.0 and later, measurementId is optional
	const firebaseConfig = {
		apiKey: "AIzaSyBk63PQRrlg6647pGw5Dof5-I-LCLexJrg",
		authDomain: "tccs-live-score.firebaseapp.com",
		databaseURL: "https://tccs-live-score-default-rtdb.europe-west1.firebasedatabase.app",
		projectId: "tccs-live-score",
		storageBucket: "tccs-live-score.firebasestorage.app",
		messagingSenderId: "142574190845",
		appId: "1:142574190845:web:654340ce971abe7cf8fe94",
		measurementId: "G-E2Q9H3JRDG"
	};

	// Initialize Firebase
	const app = initializeApp(firebaseConfig);
	const db = getDatabase(app);
	const matchesRef = ref(db, 'matches');
	const excelFileRef = ref(db, 'excelFile');
	const updatesRef = ref(db, 'lastUpdate');
	
	let matches = [];

	// Lecture des donn√©es dans la base Firebase
	async function ReadFromFirebase() {
		try {	
			const snapshot = await get(matchesRef);			
			if (snapshot.exists()) {
				matches = snapshot.val();
				console.log("ReadFromFirebase :", matches);
			} else {
				console.log("ReadFromFirebase : Aucune donn√©e trouv√©e dans Firebase.");
				matches = [];
			}
		} catch (error) {
		console.error("Erreur lors de la lecture des donn√©es :", error);
		matches = [];
		}
	}

	document.addEventListener('DOMContentLoaded', async () => {
		console.log("Listener DOMContentLoaded");
		await ReadFromFirebase();
		displayMatches();
	});


	// Lecture des donn√©es depuis fichier Excel, enregistrement dans Firebase et affichage des matchs
    document.getElementById('fileInput').addEventListener('change', (e) => {
		const file = e.target.files[0];
		const reader = new FileReader();
		reader.onload = function(evt) {
			const data = new Uint8Array(evt.target.result);
			const workbook = XLSX.read(data, { type: 'array' });
			const sheet = workbook.Sheets[workbook.SheetNames[0]];
			const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });

			matches = [];
			for (let i = 1; i < rows.length; i++) {
			  if (!rows[i]|| rows[i].length < 3) continue;
			  matches.push({
				id: rows[i][0],
				joueur1: rows[i][1],
				joueur2: rows[i][2],
				court: rows[i][3] || "",
				set1j1: rows[i][4] || 0,
				set1j2: rows[i][5] || 0,
				set2j1: rows[i][6] || 0,
				set2j2: rows[i][7] || 0,
				set3j1: rows[i][8] || 0,
				set3j2: rows[i][9] || 0,
				status: rows[i][10] || "en attente",
				startTime : rows[i][11] || "00:00:00",
				duration : rows[i][12] || "00:00:00",
				vainqueur : rows[i][13] || "",
			  });
			}

			//localStorage.setItem('matches', JSON.stringify(matches));
			console.log("Excel file loaded :", file);
			uploadMatchesToFirebase();
			displayMatches();
		};
		reader.readAsArrayBuffer(file);
		set(excelFileRef, file.name);
    });
	
	// Formatage pour affichage des matchs dans la page HTML
	function displayMatches() {
		const container = document.getElementById('forms');
		container.innerHTML = ""; // Nettoyer avant d'afficher

		if (!matches || matches.length === 0) {
			// matches est null, undefined ou vide
			const div = document.createElement('div');
			div.id = 'no-match-message';
			div.textContent = "Aucun match actuellement disponible, veuillez charger une feuille de match !";
			container.appendChild(div);		  
			return;
		}

		matches.forEach(match => {
			const formDiv = document.createElement('div');
			formDiv.className = 'grid';
			formDiv.innerHTML = `
			<h3>Match ${match.id}</h3>
			<p><strong>${match.joueur1}</strong> vs <strong>${match.joueur2}</strong></p>
			`;
			container.appendChild(formDiv);
		});
	}
	
	// Ecriture de la table des matchs dans Firebase
	function uploadMatchesToFirebase() {
		if (matches.length === 0) {
		  alert("Aucun match √† importer !");
		  return;
		}
		// ‚úÖ √âcriture dans Firebase
		set(ref(db, 'matches'), matches)
		 // .then(() => alert("Liste des matchs import√©e avec succ√®s dans Firebase !"))
		  .catch(err => console.error(err));
		  
		set(updatesRef, Date.now());
	}

	// Effacement de la table des matchs dans Firebase
	function ClearDataFirebase() {
		const lastUpdateRef = ref(db, 'lastUpdate');
		const lastDataUpdateRef = ref(db, 'lastDataUpdate');
		const matchesRef = ref(db, 'matches');
		const excelFileRef = ref(db, 'excelFile');
		
		matches = [];
		
		remove(lastUpdateRef);
		remove(lastDataUpdateRef);
		remove(matchesRef);
		remove(excelFileRef);
		displayMatches();
	}

	// Gestion Menu de navigation
	(function () {
    const btn = document.getElementById('hamburgerBtn');
    const menu = document.getElementById('dropdownMenu');
    if (!btn || !menu) return;

    const links = [...menu.querySelectorAll('a[role="menuitem"]')];

    // Page active
    const current = location.pathname.split('/').pop() || 'index.html';
    links.forEach(a => {
      if (a.getAttribute('href') === current) a.classList.add('active');
      if (a.dataset.title && !a.title) a.title = a.dataset.title; // tooltip natif
    });

    // Ouvrir/fermer
    const openMenu = () => {
      menu.classList.add('open');
      btn.setAttribute('aria-expanded', 'true');
      // Focus sur le 1er lien pour l‚Äôaccessibilit√©
      setTimeout(() => links[0]?.focus(), 0);
      document.addEventListener('click', outsideClose, { once: true });
      document.addEventListener('keydown', onKey);
    };
    const closeMenu = () => {
      menu.classList.remove('open');
      btn.setAttribute('aria-expanded', 'false');
      document.removeEventListener('keydown', onKey);
    };

    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const isOpen = menu.classList.contains('open');
      isOpen ? closeMenu() : openMenu();
    });

    // Fermer si clic √† l‚Äôext√©rieur
    const outsideClose = (e) => {
      if (!menu.contains(e.target) && e.target !== btn) closeMenu();
    };

    // Clavier: Esc ferme, fl√®ches naviguent, Tab cycle dans le menu
    function onKey(e) {
      const focusIndex = links.indexOf(document.activeElement);
      if (e.key === 'Escape') {
        e.preventDefault(); closeMenu(); btn.focus();
      } else if (e.key === 'ArrowDown') {
        e.preventDefault();
        const i = (focusIndex + 1) % links.length;
        links[i]?.focus();
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        const i = (focusIndex - 1 + links.length) % links.length;
        links[i]?.focus();
      }
    }
  })();
	
	// Bouton chargement fichier Excel
	document.getElementById('openExcel').addEventListener('click', () => { document.getElementById('fileInput').click(); });
	document.getElementById('fileInput').addEventListener('click', () => { fileInput.value = ''; });
	
	// Bouton effacement de la table des matchs dans Firebase
	document.getElementById('deleteBtn').addEventListener('click', () => { ClearDataFirebase();});
	
  </script>
</main>
<footer>¬© 2025 TCCS Score Live‚Äì Application web locale</footer>
</body>
</html>
