<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="mobile.css">
  <link rel="stylesheet" href="desktop.css" media="screen and (min-width: 1000px)">
  <title>TCCS Live Score</title>
</head>
<body>
    <header>
	  <div class="header-left">
      <img src="TCCS.JPG" alt="Logo TCCS">
      <h1>TCCS Live Score</h1>
	  <div id="header-clock" class="header-clock">Chargement...</div>
		</div>
    </header>
<div class="overlay">
  <div class="no-match-message" id="no-match"></div>
  <div class="columns">
    <div class="left-column" id="match-status"></div>
    <div class="right-column">
      <div id="scoreboards"></div>
    </div>
  </div>
  <div class="sponsor-banner">
    <img src="Bandeau_Sponsor.jpg" alt="Sponsors TCCS">
  </div>
  </div>
<script type="module">
	import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

	const firebaseConfig = {
		apiKey: "AIzaSyBk63PQRrlg6647pGw5Dof5-I-LCLexJrg",
		authDomain: "tccs-live-score.firebaseapp.com",
		databaseURL: "https://tccs-live-score-default-rtdb.europe-west1.firebasedatabase.app",
		projectId: "tccs-live-score",
		storageBucket: "tccs-live-score.firebasestorage.app",
		messagingSenderId: "142574190845",
		appId: "1:142574190845:web:654340ce971abe7cf8fe94",
		measurementId: "G-E2Q9H3JRDG"
	};

	const app = initializeApp(firebaseConfig);
	const db = getDatabase(app);

    function updateHeaderClock() {
		const clock = document.getElementById("header-clock");
		const now = new Date();
		const days = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
		const months = ['Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'];
				
		const dayName = days[now.getDay()];
		const day = now.getDate();
		const month = months[now.getMonth()];
		const year = now.getFullYear();
		const hours = String(now.getHours()).padStart(2, '0');
		const minutes = String(now.getMinutes()).padStart(2, '0');
		const seconds = String(now.getSeconds()).padStart(2, '0');
		clock.textContent = `${dayName} ${day} ${month} ${year} - ${hours}:${minutes}:${seconds}`;
	}
    setInterval(updateHeaderClock, 1000);
    window.onload = updateHeaderClock;

    function loadMatches() {
		const matchesRef = ref(db, 'matches');
		onValue(matchesRef, (snapshot) => {
			if(snapshot.exists())
			{
				const scoreboardsContainer = document.getElementById('scoreboards');
				const statusContainer = document.getElementById('match-status');

				scoreboardsContainer.innerHTML = '';
				statusContainer.innerHTML = '';
				
				const data = snapshot.val();
				// Tableaux des courts
				for (let courtNum = 1; courtNum <= 6; courtNum++) {
					const match = Object.values(data).find(m => m.court == courtNum.toString()) || null;
					let courtName = courtNum === 5 ? `COURT ${courtNum} (Mimoun)` : courtNum === 6 ? `COURT ${courtNum} (Cerdan)` : `COURT ${courtNum} (Ext.)`;
						
					const div = document.createElement('div');
					div.className = 'scoreboard';

					if(match)
					{
						const color = match.status === "termin√©" 
						? "#00ff00"           // vert
						: match.status === "en cours" 
						? "#27F2F5"           // bleu
						: "#007BFF";          // rouge

						const colorSet1j1 = (match.set1j1 == 7 || (match.set1j1 >= 6 && match.set1j1 - match.set1j2 >= 2)) ? "#38F561" : "#F2E52C";
						const colorSet2j1 = (match.set2j1 == 7 || (match.set2j1 >= 6 && match.set2j1 - match.set2j2 >= 2)) ? "#38F561" : "#F2E52C";
						const colorSet3j1 = (match.set3j1 == 7 || (match.set3j1 >= 6 && match.set3j1 - match.set3j2 >= 2)) ? "#38F561" : "#F2E52C";

						const colorSet1j2 = (match.set1j2 == 7 || (match.set1j2 >= 6 && match.set1j2 - match.set1j1 >= 2)) ? "#38F561" : "#F2E52C";
						const colorSet2j2 = (match.set2j2 == 7 || (match.set2j2 >= 6 && match.set2j2 - match.set2j1 >= 2)) ? "#38F561" : "#F2E52C";
						const colorSet3j2 = (match.set3j2 == 7 || (match.set3j2 >= 6 && match.set3j2 - match.set3j1 >= 2)) ? "#38F561" : "#F2E52C";

						div.innerHTML = `
						<div class="header">
						  <span class="court">${courtName}</span>
						  <span class="clock" style="color: ${color};">${match.duration}</span>
						</div>
						<table>
						  <thead>
							<tr>
							  <th></th>
							  <th>SET 1</th>
							  <th>SET 2</th>
							  <th>SET 3</th>
							</tr>
						  </thead>
						  <tbody>
							<tr>
							  <td class="label">${match.joueur1}</td>
							  <td style="color: ${colorSet1j1};">${match.set1j1}</td>
							  <td style="color: ${colorSet2j1};">${match.set2j1}</td>
							  <td style="color: ${colorSet3j1};">${match.set3j1}</td>
							</tr>
							<tr>
							  <td class="label">${match.joueur2}</td>
							  <td style="color: ${colorSet1j2};">${match.set1j2}</td>
							  <td style="color: ${colorSet2j2};">${match.set2j2}</td>
							  <td style="color: ${colorSet3j2};">${match.set3j2}</td>
							</tr>
						  </tbody>
						</table>
						`;
					}
					else{
						// Court sans match
						div.innerHTML = `
						<div class="header">
						  <span class="court">${courtName}</span>
						  <span class="clock" style="color: #ff3333;">00:00:00</span>
						</div>
						<table>
						  <thead>
							<tr>
							  <th></th>
							  <th>SET 1</th>
							  <th>SET 2</th>
							  <th>SET 3</th>
							</tr>
						  </thead>
						  <tbody>
							<tr>
							  <td class="label">Joueur 1</td>
							  <td>0</td>
							  <td>0</td>
							  <td>0</td>
							</tr>
							<tr>
							  <td class="label">Joueur 2</td>
							  <td>0</td>
							  <td>0</td>
							  <td>0</td>
							</tr>
						  </tbody>
						</table>
						`;						
					}
					scoreboardsContainer.appendChild(div);
				}
				
				// Matchs termin√©s
				const endedMatches = Object.values(data).filter(m => m.status === "termin√©");
				const endedContainer = document.createElement('div');
				endedContainer.className = 'left-column';
				endedContainer.innerHTML = `<h2 style="color:white;text-align:center;">Matchs termin√©s</h2>`;
				endedMatches.forEach(match => {
				  const item = document.createElement('div');
				  item.className = 'ended-match';
				  item.innerHTML = match.vainqueur === "joueur1"
					? `üèÜ ${match.joueur1} <span class="vs-box">VS</span> ${match.joueur2}`
					: `${match.joueur1} <span class="vs-box">VS</span> ${match.joueur2} üèÜ`;
				  endedContainer.appendChild(item);
				});

				// Matchs en attente
				const pendingMatches = Object.values(data).filter(m => m.status === "en attente");
				const pendingContainer = document.createElement('div');
				pendingContainer.className = 'left-column';
				pendingContainer.innerHTML = `<h2 style="color:white;text-align:center;">Matchs en attente</h2>`
				pendingMatches.forEach(match => {
				  const item = document.createElement('div');
				  item.className = 'pending-match';
				  item.innerHTML = `${match.joueur1} <span class="vs-box">VS</span> ${match.joueur2}`;
				  pendingContainer.appendChild(item);
				});					
				statusContainer.appendChild(endedContainer);
				statusContainer.appendChild(pendingContainer);	
			}			
			else {
				const noMatchContainer = document.getElementById('no-match');
				noMatchContainer.innerHTML = '';


				const div = document.createElement('div');
				div.id = 'no-match-message';
				div.textContent = 'Aucun match actuellement, revenez au prochain tournoi !';
							
				noMatchContainer.appendChild(div);
			}	

      });
	}

    document.addEventListener('DOMContentLoaded', () => {
      loadMatches();
    });
</script>
</body>
</html>
